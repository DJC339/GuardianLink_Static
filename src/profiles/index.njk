---
layout: layouts/base.html
title: Browse Profiles
contentWrapperClass: ""
---
<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <h2 class="text-2xl font-bold mb-4">Browse Profiles</h2>

  <div class="search-card mb-6">
    <form id="search-form" class="flex flex-col sm:flex-row gap-3" role="search">
      <input id="search-input" type="search" placeholder="Search by name or email" class="w-full rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
      <button class="btn-primary w-full sm:w-auto" type="submit">Search</button>
    </form>
  </div>

  <div id="profiles-row" class="grid md:grid-cols-3 sm:grid-cols-2 gap-6">
    {% for profile in profiles %}
      {% set user = users | findUser(profile.user_id) %}
      {% set imgSrc = "/assets/images/" + (profile.profile_picture or "placeholder.png") %}
      <div class="profile-card card-surface p-6 flex flex-col items-center text-center gap-2" data-name="{{ user.name | lower }}" data-email="{{ user.email | lower }}">
        <img src="{{ imgSrc }}" alt="{{ user.name }}'s Profile Picture" class="current-profile-pic">
        <h5 class="text-lg font-semibold">{{ user.name }}</h5>
        <p class="text-slate-600 text-sm">{{ user.email }}</p>
        <span class="badge-role">{{ user.user_type | userTypeLabel }}</span>
        <div class="text-sm text-slate-700">
          {% if user.user_type == 1 and profile.availability %}
            <p><strong>Availability:</strong> {{ profile.availability }}</p>
          {% elseif user.user_type == 0 and profile.concern %}
            <p><strong>Concern:</strong> {{ profile.concern }}</p>
          {% endif %}
        </div>
        <div class="mt-3 w-full">
          <a class="btn-secondary w-full justify-center" href="/profiles/{{ profile.id }}/">View Profile</a>
        </div>
      </div>
    {% endfor %}
  </div>
  <div id="empty-state" class="hidden mt-6 rounded-lg border border-blue-200 bg-blue-50 text-blue-800 px-4 py-3" role="alert">
    No profiles available to display.
  </div>
</div>

<script>
  // Inline data for client-side search
  const profilesData = [
    {% for profile in profiles %}
      {% set user = users | findUser(profile.user_id) %}
      {{ {
        id: profile.id,
        user: user,
        availability: profile.availability,
        concern: profile.concern,
        criminal_check: profile.criminal_check
      } | dump }}{{ "," if not loop.last else "" }}
    {% endfor %}
  ];

  const searchInput = document.getElementById("search-input");
  const form = document.getElementById("search-form");
  const cards = Array.from(document.querySelectorAll(".profile-card"));
  const emptyState = document.getElementById("empty-state");

  const index = profilesData.map((p) => {
    return {
      id: p.id,
      name: (p.user && p.user.name) ? p.user.name.toLowerCase() : "",
      email: (p.user && p.user.email) ? p.user.email.toLowerCase() : "",
    };
  });

  function applyFilter(q) {
    const query = (q || "").trim().toLowerCase();
    let visibleCount = 0;
    cards.forEach((card, idx) => {
      const match = !query || index[idx].name.includes(query) || index[idx].email.includes(query);
      card.style.display = match ? "" : "none";
      if (match) visibleCount += 1;
    });
    if (visibleCount === 0) {
      emptyState.classList.remove("hidden");
    } else {
      emptyState.classList.add("hidden");
    }
  }

  form.addEventListener("submit", (e) => {
    e.preventDefault();
    applyFilter(searchInput.value);
  });

  searchInput.addEventListener("input", () => applyFilter(searchInput.value));

  // Pre-fill from ?query=
  const params = new URLSearchParams(window.location.search);
  if (params.has("query")) {
    searchInput.value = params.get("query");
    applyFilter(searchInput.value);
  }
</script>
